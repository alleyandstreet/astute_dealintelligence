generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  username  String   @unique
  password  String
  email     String?
  role      String   @default("member")
  isActive  Boolean  @default(true)
  lastLogin DateTime?
  logs      ActivityLog[]
  businesses Business[]
}

model Business {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String
  description String?
  industry    String?
  valuation   Float?
  revenue     Float?
  status      String   @default("active")
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  action    String
  details   String?
  ipAddress String?
  userAgent String?
}

model Deal {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String
  description String?
  industry    String?
  location    String?
  url         String?
  askingPrice    Float?
  revenue        Float?
  revenueType    String?
  ebitda         Float?
  sde            Float?
  valuationMin   Float?
  valuationMax   Float?
  source         String
  sourceId       String?  @unique
  sourceName     String?
  redditUrl      String?
  redditAuthor   String?
  redditScore    Int?
  redditComments Int?
  status         String   @default("new_leads")
  aiSummary       String?
  viabilityScore  Int?
  motivationScore Int?
  dealQuality     Int?
  riskFlags       String?
  sellerSignals   String?
  businessType    String?
  contactReddit   String?
  contactEmail    String?
  contactWebsite  String?
  contactTwitter  String?
  contactLinkedIn String?
  contactDiscord  String?
  notes       Note[]
  outreaches  Outreach[]
  tags        DealTag[]
}

model Note {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  content   String
  dealId    String
  deal      Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model Outreach {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  type      String
  message   String
  status    String   @default("sent")
  dealId    String
  deal      Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model Tag {
  id    String    @id @default(cuid())
  name  String    @unique
  color String    @default("#06b6d4")
  deals DealTag[]
}

model DealTag {
  id     String @id @default(cuid())
  dealId String
  tagId  String
  deal   Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)
}

model SearchConfig {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  name       String
  subreddits String
  keywords   String
  isDefault  Boolean  @default(false)
}

model ScanLog {
  id           String   @id @default(cuid())
  startedAt    DateTime @default(now())
  completedAt  DateTime?
  status       String   @default("running")
  postsScanned Int      @default(0)
  dealsFound   Int      @default(0)
  errors       String?
}

model TeamMessage {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  content   String
  sender    String   @default("User")
  senderEmail String? // For identity verification
  attachment String? // Base64 or URL
  attachmentType String? // image, file, etc.
  editHistory Json? // Array of { content, timestamp }
  deletedFor String[] @default([]) // Array of emails
}
